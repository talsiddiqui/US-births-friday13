---
title: "Exploratory Data Analysis"
author: "Talha Siddiqui"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
library(tidyverse)
library(lubridate)
```

```{r}
data <- read_csv("data/US_births_2000-2014_SSA_formatted.csv")
```


## Interesting Trends

I'm curious to know what are the least favorite days to give birth.

```{r}
data %>% 
  mutate(dm = as.integer(paste(month(date), day(date),sep = "")),
         month_day = paste(month(date, label = TRUE), day(date),sep = "-"),
         daily_avg = mean(births)) %>% 
  group_by(dm, month_day, daily_avg) %>% 
  summarise(births = mean(births)) %>%
  mutate(less_births = births - daily_avg) %>% 
  arrange(less_births) %>% 
  head(10) %>% 
  ggplot(aes(fct_reorder(month_day, dm), less_births, fill = month_day)) +
  geom_col() + 
  labs(
    title = "Top 10 least popular days to give birth",
    subtitle = "Number of births less than daily average (11,350)",
    x = "",
    y = ""
  ) + 
  theme(legend.position = "none")
```

How about the most favorite days to give birth?

```{r}
data %>% 
  mutate(dm = as.integer(paste(month(date), day(date),sep = "")),
         month_day = paste(month(date, label = TRUE), day(date),sep = "-"),
         daily_avg = mean(births)) %>% 
  group_by(dm, month_day, daily_avg) %>% 
  summarise(births = mean(births)) %>%
  mutate(less_births = births - daily_avg) %>% 
  arrange(desc(less_births)) %>% 
  head(10) %>% 
  ggplot(aes(fct_reorder(month_day, dm), less_births, fill = month_day)) +
  geom_col() + 
  labs(
    title = "Top 10 most popular days to give birth",
    subtitle = "Number of births above than daily average (11,350)",
    x = "",
    y = ""
  ) + 
  theme(legend.position = "none")
```

So many days in September made it to the top of the list. That's ... interesting!

```{r}
data %>% 
  group_by(day = factor(day, levels= c("Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"))) %>% 
  summarise(avg_births = mean(births)) %>% 
  ggplot(aes(day, avg_births, fill = day)) + geom_col() + 
  labs(
    title = "Average births per day of the week",
    x = "",
    y = "Average Births"
  ) + 
  theme(legend.position = "none")
```

Weekends tend to have much fewer births.

What about the question we are really curious about -- Friday The 13th?

```{r}
data %>% 
  group_by(friday13) %>% 
  summarise(avg_births = mean(births)) %>% 
  ggplot(aes(friday13, avg_births, fill = friday13)) + geom_col() + 
  labs(
    title = "Average daily births",
    subtitle = "Friday The 13th vs. any other day",
    x = "Friday The 13th?",
    y = "Average births per day"
  ) + 
  theme(legend.position = "none")
```

What about all 13's -- any day of the week.

```{r}
data %>% 
  filter(day(date)==13) %>% 
  group_by(day = factor(day, levels= c("Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"))) %>% 
  summarise(avg_births = mean(births)) %>% 
  ggplot(aes(day, avg_births, fill = day)) + geom_col() + 
  labs(
    title = "Average births on 13th falling on different days of the week",
    x = "",
    y = "Average Births"
  ) + 
  theme(legend.position = "none")
```

That doesn't seem to be showing any significant drops for when 13th falls on Friday.

We have to conduct this test now!

But meanwhile, let's explore the data some more.

```{r}
data %>% 
  group_by(friday13) %>% 
  ggplot(aes(friday13, births, fill = friday13)) + 
  geom_violin() + 
  geom_jitter(alpha = 0.3) +
  labs(
    title = "Spread of Daily Births",
    subtitle = "Friday The 13th vs. any other day",
    x = "Friday The 13th?",
    y = "Births per day"
  ) + 
  theme(legend.position = "none")
```

Those two clusters really stand out. Lets dig a little deeper.

```{r}
data %>% 
  ggplot(aes(births)) + geom_histogram(binwidth = 100) + expand_limits(x=0)
```

That's quite a difference. What is going on here? (work in progress)

```{r}
data %>% 
  mutate(chunk = as_factor(case_when(births < 10000 ~ "low_births",
                           births >= 10000 ~ "high_births")))
```


```{r eval=FALSE}
data %>% 
  mutate(year = as.integer(year(date))) %>% 
  group_by(year) %>% 
  summarise(total_births = sum(births),
            avg_births = mean(births),
            med_births = median(births)) %>% 
  ggplot(aes(year, med_births)) + 
  geom_line() + 
  expand_limits(y=0)
```

